<!DOCTYPE html>
<html>
<head>
    <title>LIFF Form Sample</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
    <h1>LIFF Form Sample</h1>
    <form id="myForm">
        <label for="username">目的地</label>
        <input type="text" id="username" name="username">梅田<br><br>
        <label for="message">交通手段</label>
        <input type="text" id="message" name="message">徒歩<br><br>
        <label for="message">空き時間</label>
        <input type="text" id="message" name="message">2時間<br><br>
        <button type="button" onclick="submitForm()">送信</button>
    </form>

    <script>
        async function submitForm() {
            const username = document.getElementById('username').value;
            const message = document.getElementById('message').value;
            console.log('submitForm ====== username:', username);
            // LIFFの初期化とユーザーIDの取得
            await liff.init({ liffId: "2003429965-rZvm4pBW" });
            const userId = liff.getContext().userId;
            console.log('submitForm ====== userId:', userId);
        
            // GASのWebアプリURLにデータを送信
            // FIXME: CORSエラーが発生する
            fetch('https://script.google.com/macros/s/AKfycbxbdkotYcxHYzoZhFEjiYEY1QB5hFaJKz1rKXsc6Z0iTrdI0RJ28cl32KT1LcKRB8HpoQ/exec', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ userId, username, message }),
            })
            .then(response => response.json())
            .then(data => {
                console.log(data);
                if(data.result === "success") {
                    liff.closeWindow(); // データ送信成功時にLIFFアプリを閉じる
                }
            })
            .catch(error => {
                console.error('Error:', error);
                liff.closeWindow(); // データ送信失敗時にもLIFFアプリを閉じる
            });
        
            console.log('submitForm ====== end')
        }
        </script>
</body>
</html>
